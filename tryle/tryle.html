{% extends 'base/base.html' %}
{% load static %}
{% block title %}Home - Pandharpur Guide{% endblock %}
{% block content %}



<link rel="stylesheet" href="{% static 'home/home.css' %}">
<div class="advertisements">
    {% for ad in advertisements %}
        {% if ad.position == "below-menu" %}
            <div class="advertisement fade-in" id="ad-below-menu-{{ forloop.counter }}">
                <button class="cancel-btn" onclick="cancelAd('ad-below-menu-{{ forloop.counter }}')">X</button>
                <img src="{{ ad.image.url }}" alt="{{ ad.title }}" />
                <h3>{{ ad.title }}</h3>
            </div>
        {% endif %}
    {% endfor %}
</div>
<div class="advertisements-left-side">
    {% for ad in advertisements %}
        {% if ad.position == "left-side-of-page" %}
            <div class="advertisement fade-in" id="ad-left-side-{{ forloop.counter }}">
                <button class="cancel-btn" onclick="cancelAd('ad-left-side-{{ forloop.counter }}')">X</button>
                <img src="{{ ad.image.url }}" alt="{{ ad.title }}" />
                <h3>{{ ad.title }}</h3>
            </div>
        {% endif %}
    {% endfor %}
</div>
<div class="advertisements-right-side">
    {% for ad in advertisements %}
        {% if ad.position == "right-side-of-page" %}
            <div class="advertisement fade-in" id="ad-right-side-{{ forloop.counter }}">
                <button class="cancel-btn" onclick="cancelAd('ad-right-side-{{ forloop.counter }}')">X</button>
                <img src="{{ ad.image.url }}" alt="{{ ad.title }}" />
                <h3>{{ ad.title }}</h3>
            </div>
        {% endif %}
    {% endfor %}
</div>

<!-- Main Content -->
<div class="content">
    <div class="carousel-container">
        <div class="arrow left" onclick="previousImage()">❮</div>
        <div class="carousel">
            {% for image in images %}
                <img alt="{{ image.heading }}" src="{{ image.image.url }}" />
            {% endfor %}
        </div>
        <div class="arrow right" onclick="nextImage()">❯</div>
    </div>
    <div class="image-details">
        <h2 id="image-heading">{{ images.0.heading }}</h2>
        <div class="image-counter">
            <span id="current-index">1</span>/<span id="total-images">{{ images|length }}</span>
        </div>
    </div>
</div>

<!-- Image Management -->
<div id="image-management">
    <h2>Manage Images</h2>
    <div class="image-list">
        {% for image in images %}
        <div class="image-item">
            <img src="{{ image.image.url }}" alt="{{ image.heading }}">
            <input type="text" value="{{ image.heading }}" placeholder="Heading" data-index="{{ forloop.counter0 }}">
            <textarea placeholder="Description" data-index="{{ forloop.counter0 }}">{{ image.description }}</textarea>
            <button onclick="saveEdit({{ forloop.counter0 }})">Save</button>
        </div>
        {% endfor %}
    </div>
    <h2>Add New Image</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Add Image</button>
    </form>
</div>

<div class="darshan-section">
    {% for image in images %}
    <div class="darshan" data-aos="zoom-in">
        <h2>Top Places to Visit in Pandharpur Darshan</h2>
        <p><b>{{ forloop.counter }}. {{ image.heading }}</b></p>
        <img src="{{ image.image.url }}" alt="{{ image.heading }}">
        <h3>{{ image.description }}</h3>
    </div>
    {% endfor %}
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
<script src="{% static 'home/home.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const ads = document.querySelectorAll('.advertisement');
        ads.forEach((ad, index) => {
            setTimeout(() => {
                showAd(ad.id);
            }, index * 1000);
        });
    
        const totalImages = document.querySelectorAll('.carousel img').length;
        document.getElementById('total-images').textContent = totalImages;
        updateCarousel();
    });
    
    function showAd(adId) {
        const adElement = document.getElementById(adId);
        if (adElement) {
            adElement.classList.add('fade-in');
            adElement.style.display = 'block';
        }
    }
    
    function cancelAd(adId) {
        const adElement = document.getElementById(adId);
        if (adElement) {
            adElement.classList.remove('fade-in');
            adElement.classList.add('fade-out');
            setTimeout(() => {
                adElement.style.display = 'none';
                adElement.classList.remove('fade-out');
                setTimeout(() => showAd(adId), 5000);
            }, 500);
        }
    }
    
    let currentIndex = 0;
    
    function updateCarousel() {
        const carousel = document.querySelector('.carousel');
        const offset = -currentIndex * 1000;
        carousel.style.transform = `translateX(${offset}px)`;
    
        const headings = document.querySelectorAll('.image-item input');
        const descriptions = document.querySelectorAll('.image-item textarea');
    
        document.getElementById('image-heading').textContent = headings[currentIndex].value;
        document.getElementById('image-description').textContent = descriptions[currentIndex].value;
        document.getElementById('current-index').textContent = currentIndex + 1;
    }
    
    function previousImage() {
        const images = document.querySelectorAll('.carousel img');
        currentIndex = (currentIndex > 0) ? currentIndex - 1 : images.length - 1;
        updateCarousel();
    }
    
    function nextImage() {
        const images = document.querySelectorAll('.carousel img');
        currentIndex = (currentIndex < images.length - 1) ? currentIndex + 1 : 0;
        updateCarousel();
    }
    
    function saveEdit(index) {
        const heading = document.querySelectorAll('.image-item input')[index].value;
        const description = document.querySelectorAll('.image-item textarea')[index].value;
    
        console.log(`Save heading: ${heading}, description: ${description}`);
    }
    
    // AOS Initialization
    AOS.init({
        duration: 1000,
        once: true,
        easing: 'ease-in-out',
    });
    
    // Popup Functionality
    document.querySelectorAll('.darshan img').forEach(image => {
        image.addEventListener('click', function (event) {
            event.stopPropagation();
    
            const popup = document.createElement('div');
            popup.className = 'popup';
            popup.innerHTML = `
                <div class="popup-content">
                    <span class="close-btn">&times;</span>
                    <img src="${this.src}" alt="Full Size Image">
                </div>
            `;
    
            document.body.appendChild(popup);
            popup.style.display = 'block';
    
            popup.addEventListener('dblclick', function () {
                this.querySelector('.popup-content').classList.toggle('fullscreen');
            });
    
            popup.querySelector('.close-btn').addEventListener('click', function (e) {
                e.stopPropagation();
                popup.remove();
            });
    
            popup.addEventListener('click', function (e) {
                if (e.target === popup) {
                    popup.remove();
                }
            });
        });
    });
    
</script>

{% endblock content %}
